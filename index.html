<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣空氣品質即時監測 (Taiwan AQI)</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        aqi: {
                            good: '#009866',      /* 0-50 */
                            moderate: '#FFDE33',  /* 51-100 */
                            sensitive: '#FF9933', /* 101-150 */
                            unhealthy: '#CC0033', /* 151-200 */
                            very_unhealthy: '#660099', /* 201-300 */
                            hazardous: '#7E0023'  /* 301+ */
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-gray-100 dark:bg-gray-900 h-screen w-screen overflow-hidden relative transition-colors duration-300">

    <!-- Map Container -->
    <div id="map" class="absolute inset-0 z-0 bg-gray-200 dark:bg-gray-800"></div>

    <!-- UI Overlay: Header (Top Left) -->
    <div class="absolute top-4 left-4 z-10 pointer-events-none w-full max-w-md flex flex-col gap-3">
        <!-- Main Header -->
        <div
            class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-md p-4 rounded-2xl shadow-lg pointer-events-auto flex flex-col gap-3 border border-white/20 dark:border-gray-700 transition-colors duration-300">
            <h1 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                <i class="fa-solid fa-wind text-blue-500"></i>
                台灣空氣品質即時監測
            </h1>

            <div class="flex gap-2">
                <select id="county-select"
                    class="flex-1 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none transition-all hover:bg-white dark:hover:bg-gray-600">
                    <option value="all" selected>全台灣</option>
                    <!-- Counties will be populated here -->
                </select>
                <button id="refresh-btn"
                    class="p-2.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors shadow-sm"
                    title="重新整理">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
                <button id="locate-btn"
                    class="p-2.5 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-200 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm"
                    title="定位我的位置">
                    <i class="fa-solid fa-crosshairs"></i>
                </button>
                <button id="list-btn"
                    class="p-2.5 bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-200 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm"
                    title="測站列表">
                    <i class="fa-solid fa-list"></i>
                </button>
                <button id="theme-toggle-btn"
                    class="p-2.5 bg-white dark:bg-gray-700 text-gray-600 dark:text-yellow-400 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors shadow-sm"
                    title="切換深色模式">
                    <i class="fa-solid fa-moon dark:hidden"></i>
                    <i class="fa-solid fa-sun hidden dark:inline"></i>
                </button>
            </div>

            <div class="text-xs text-gray-500 dark:text-gray-400 flex justify-between items-center">
                <span id="last-update">更新時間: 載入中...</span>
                <span id="station-count">測站數: 0</span>
            </div>
        </div>

        <!-- Dashboard (Stats) -->
        <div id="dashboard"
            class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-md p-3 rounded-2xl shadow-lg pointer-events-auto border border-white/20 dark:border-gray-700 hidden md:flex justify-between gap-2 overflow-x-auto transition-colors duration-300">
            <!-- Populated by JS -->
            <div class="text-xs text-gray-400">載入統計中...</div>
        </div>
    </div>

    <!-- Station List Sidebar -->
    <div id="station-list-sidebar"
        class="absolute top-0 left-0 h-full w-80 bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl shadow-2xl z-20 transform -translate-x-full transition-transform duration-300 border-r border-white/20 dark:border-gray-700 flex flex-col">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
            <h2 class="text-lg font-bold text-gray-800 dark:text-white">測站列表</h2>
            <button id="close-list-btn"
                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        <div class="p-4">
            <input type="text" id="station-search" placeholder="搜尋測站或縣市..."
                class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 outline-none transition-all">
        </div>
        <div id="station-list-container" class="flex-1 overflow-y-auto p-4 space-y-2">
            <!-- List items populated by JS -->
        </div>
    </div>

    <!-- UI Overlay: Legend (Bottom Left) -->
    <div class="absolute bottom-8 left-4 z-10 pointer-events-none hidden md:block">
        <div
            class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-md p-4 rounded-2xl shadow-lg pointer-events-auto border border-white/20 dark:border-gray-700 transition-colors duration-300">
            <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">AQI 指標說明</h3>
            <div class="flex flex-col gap-2 text-xs font-medium dark:text-gray-300">
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#009866]"></span> 良好 (0-50)
                </div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#FFDE33]"></span> 普通 (51-100)
                </div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#FF9933]"></span> 對敏感族群不健康
                    (101-150)</div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#CC0033]"></span> 不健康
                    (151-200)</div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#660099]"></span> 非常不健康
                    (201-300)</div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-[#7E0023]"></span> 危害 (301+)
                </div>
            </div>
        </div>
    </div>

    <!-- Details Panel (Sidebar/Modal) -->
    <!-- Hidden by default, slides in or pops up -->
    <div id="details-panel"
        class="absolute bottom-0 md:top-4 md:bottom-auto md:right-4 w-full md:w-96 bg-white/95 dark:bg-gray-800/95 backdrop-blur-xl shadow-2xl z-20 rounded-t-3xl md:rounded-2xl transform transition-transform duration-300 translate-y-full md:translate-y-0 md:translate-x-[120%] p-5 border border-white/20 dark:border-gray-700 max-h-[80vh] overflow-y-auto transition-colors duration-300">
        <div class="flex justify-between items-center mb-4">
            <h2 id="panel-station-name" class="text-xl font-bold text-gray-800 dark:text-white">測站名稱</h2>
            <button id="close-panel-btn"
                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>

        <div class="flex items-center justify-between mb-6">
            <div id="panel-aqi-badge"
                class="flex flex-col items-center justify-center w-20 h-20 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white shadow-inner shrink-0 transition-colors">
                <span class="text-xs font-semibold">AQI</span>
                <span id="panel-aqi-value" class="text-2xl font-bold">-</span>
            </div>
            <div class="flex-1 ml-4">
                <div id="panel-status-text" class="text-lg font-bold text-gray-700 dark:text-gray-200 mb-1">-</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">狀態</div>
            </div>
        </div>

        <!-- Weather Info -->
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div
                class="bg-blue-50/50 dark:bg-blue-900/20 p-2 rounded-xl border border-blue-100 dark:border-blue-800 flex items-center gap-2">
                <i class="fa-solid fa-wind text-blue-400 text-lg ml-1"></i>
                <div>
                    <div class="text-[10px] text-gray-500 dark:text-gray-400">風速</div>
                    <div id="panel-wind-speed" class="text-sm font-semibold text-gray-700 dark:text-gray-200">- m/s
                    </div>
                </div>
            </div>
            <div
                class="bg-blue-50/50 dark:bg-blue-900/20 p-2 rounded-xl border border-blue-100 dark:border-blue-800 flex items-center gap-2">
                <i class="fa-regular fa-compass text-blue-400 text-lg ml-1"></i>
                <div>
                    <div class="text-[10px] text-gray-500 dark:text-gray-400">風向</div>
                    <div id="panel-wind-dir" class="text-sm font-semibold text-gray-700 dark:text-gray-200">-°</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-4">
            <div
                class="bg-white/50 dark:bg-gray-700/50 p-3 rounded-xl border border-gray-100 dark:border-gray-600 relative group">
                <div class="flex justify-between items-start">
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">PM2.5</div>
                    <button class="info-btn text-gray-400 hover:text-blue-500 transition-colors" data-pollutant="pm2.5">
                        <i class="fa-solid fa-circle-info text-[10px]"></i>
                    </button>
                </div>
                <div id="panel-pm25" class="text-lg font-semibold text-gray-800 dark:text-white">-</div>
                <div class="text-[10px] text-gray-400">μg/m³</div>
            </div>
            <div
                class="bg-white/50 dark:bg-gray-700/50 p-3 rounded-xl border border-gray-100 dark:border-gray-600 relative group">
                <div class="flex justify-between items-start">
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">PM10</div>
                    <button class="info-btn text-gray-400 hover:text-blue-500 transition-colors" data-pollutant="pm10">
                        <i class="fa-solid fa-circle-info text-[10px]"></i>
                    </button>
                </div>
                <div id="panel-pm10" class="text-lg font-semibold text-gray-800 dark:text-white">-</div>
                <div class="text-[10px] text-gray-400">μg/m³</div>
            </div>
            <div
                class="bg-white/50 dark:bg-gray-700/50 p-3 rounded-xl border border-gray-100 dark:border-gray-600 col-span-2 relative group">
                <div class="flex justify-between items-start">
                    <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">主要污染物</div>
                    <button class="info-btn text-gray-400 hover:text-blue-500 transition-colors" data-pollutant="main">
                        <i class="fa-solid fa-circle-info text-[10px]"></i>
                    </button>
                </div>
                <div id="panel-pollutant" class="text-sm font-medium text-gray-800 dark:text-white">-</div>
            </div>
        </div>

        <!-- Chart Container -->
        <div class="mb-4">
            <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider">污染物分析</h3>
            <div
                class="bg-white/50 dark:bg-gray-700/50 p-2 rounded-xl border border-gray-100 dark:border-gray-600 h-48 relative">
                <canvas id="pollutantChart"></canvas>
            </div>
        </div>

        <div class="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-xl border border-blue-100 dark:border-blue-800 mb-2">
            <div class="flex items-start gap-2">
                <i class="fa-solid fa-circle-info text-blue-500 mt-0.5 text-sm"></i>
                <div>
                    <div class="text-xs font-bold text-blue-700 dark:text-blue-300 mb-1">健康建議</div>
                    <p id="panel-advice" class="text-xs text-blue-600 dark:text-blue-200 leading-relaxed">
                        載入中...
                    </p>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <span class="text-[10px] text-gray-400">資料來源：環境部開放資料平臺</span>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay"
        class="absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center transition-opacity duration-300">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
        <p class="text-gray-600 font-medium animate-pulse">載入空氣品質資料中...</p>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- App Scripts -->
    <script type="module" src="js/main.js"></script>
</body>

</html>